<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>장바구니</title>
  <link rel="stylesheet" href="/css/site.css">
</head>
<body>
<div th:replace="fragments :: topbar"></div>
<main class="container grid">
  <div class="message error" th:if="${errorMessage}" th:text="${errorMessage}"></div>
  <div class="message success" th:if="${successMessage}" th:text="${successMessage}"></div>

  <section class="table-wrap" th:if="${cart.items != null and !cart.items.isEmpty()}">
    <table>
      <thead>
      <tr>
        <th>상품</th>
        <th>수량</th>
        <th>금액</th>
        <th>관리</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="item : ${cart.items}">
        <td>
          <strong th:text="${item.product_name}">상품명</strong>
          <div class="meta" th:if="${item.is_weight_item}">중량 상품</div>
        </td>
        <td>
          <form class="inline" th:action="@{/cart/items/{id}/qty(id=${item.id})}" method="post">
            <input name="qty" type="number" min="1" max="99" th:value="${item.qty}" style="width:84px;">
            <button class="subtle" type="submit">변경</button>
          </form>
        </td>
        <td th:text="${#numbers.formatDecimal(item.line_total, 0, 'COMMA', 0, 'POINT')} + '원'"></td>
        <td>
          <form th:action="@{/cart/items/{id}/delete(id=${item.id})}" method="post">
            <button class="warn" type="submit">삭제</button>
          </form>
        </td>
      </tr>
      </tbody>
    </table>
  </section>

  <section class="panel" th:if="${cart.items == null or cart.items.isEmpty()}">
    <p>장바구니가 비어 있습니다.</p>
    <a class="btn" href="/products">상품 보러가기</a>
  </section>

  <section class="panel" th:if="${cart.items != null and !cart.items.isEmpty()}">
    <h3>합계</h3>
    <p class="price" th:text="${#numbers.formatDecimal(cart.subtotal, 0, 'COMMA', 0, 'POINT')} + '원'"></p>
    <a class="btn" th:href="@{/checkout(dongCode=${dongCode})}">체크아웃</a>
  </section>
</main>
</body>
</html>

<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>주문 상세</title>
  <link rel="stylesheet" href="/css/site.css">
</head>
<body>
<div th:replace="fragments :: topbar"></div>
<main class="container grid">
  <div class="message error" th:if="${errorMessage}" th:text="${errorMessage}"></div>
  <div class="message success" th:if="${successMessage}" th:text="${successMessage}"></div>

  <section class="panel">
    <h3 th:text="'주문번호: ' + ${order.order_no}"></h3>
    <p class="meta">상태: <strong th:text="${order.status}"></strong></p>
    <p class="meta">주문자: <span th:text="${order.customer_name}"></span> / <span th:text="${order.customer_phone}"></span></p>
    <p class="meta">희망배송시간: <span th:text="${order.requested_slot_start}"></span></p>
  </section>

  <section class="table-wrap">
    <table>
      <thead>
      <tr>
        <th>상품</th>
        <th>수량</th>
        <th>금액</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="item : ${order.items}">
        <td th:text="${item.product_name}"></td>
        <td th:text="${item.qty_ordered}"></td>
        <td th:text="${#numbers.formatDecimal(item.line_estimated, 0, 'COMMA', 0, 'POINT')} + '원'"></td>
      </tr>
      </tbody>
    </table>
  </section>

  <section class="panel">
    <p>상품금액: <strong th:text="${#numbers.formatDecimal(order.subtotal_estimated, 0, 'COMMA', 0, 'POINT')} + '원'"></strong></p>
    <p>배송비: <strong th:text="${#numbers.formatDecimal(order.delivery_fee, 0, 'COMMA', 0, 'POINT')} + '원'"></strong></p>
    <p class="price">예상총액: <span th:text="${#numbers.formatDecimal(order.total_estimated, 0, 'COMMA', 0, 'POINT')} + '원'"></span></p>

    <form method="post" th:if="${order.status == 'RECEIVED'}" th:action="@{/orders/{orderNo}/cancel(orderNo=${order.order_no})}" class="grid" style="gap:8px;max-width:420px;">
      <input type="hidden" name="phone" th:value="${phone}">
      <label>취소 사유
        <input name="reason" value="고객 요청 취소">
      </label>
      <button class="warn" type="submit">주문 취소 요청</button>
    </form>
  </section>
</main>
</body>
</html>
